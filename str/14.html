<!doctype html>
<html lang="ru">

<head>
  <meta charset="utf-8">
  <title>HTML Document Template</title>
  <link href="styles.css" rel="stylesheet">
</head>

<body>
  <div class="header__menu">
    <ul>
      <li><a href="str/1">1</a></li>
      <li><a href="str/2">2</a></li>
      <li><a href="str/3">3</a></li>
      <li><a href="str/4">4</a></li>
      <li><a href="str/5">5</a></li>
      <li><a href="str/6">6</a></li>
      <li><a href="str/7">7</a></li>
      <li><a href="str/8">8</a></li>
      <li><a href="str/9">9</a></li>
      <li><a href="str/10">10</a></li>
      <li><a href="str/11">11</a></li>
      <li><a href="str/12">12</a></li>
      <li><a href="str/13">13</a></li>
      <li><a href="str/14">14</a></li>
      <li><a href="str/15">15</a></li>
      <li><a href="str/16">16</a></li>
    </ul>
  </div>
  <h1>14</h1>
  <H2 class="OU">
    Оперативный учет
  </H2>
  <pre>
    <p>///// Общий модуль ОбработкаТабличнойЧасти</p>
    Процедура РассчитатьСуммуВСтроке(ТекСтрока) Экспорт
      ТекСтрока.Сумма = ТекСтрока.Цена * ТекСтрока.Количество;
    КонецПроцедуры 
    
    <p>///// Общий модуль ПрефиксацияОбъектов</p>
    Функция НомерНаПечать(Знач НомерОбъекта) Экспорт
      
      Пока Лев(НомерОбъекта, 1) = "0" Цикл
        НомерОбъекта = Сред(НомерОбъекта, 2);
      КонецЦикла;
      
      Возврат НомерОбъекта;
      
    КонецФункции
    
    <p>///// Документ ПриходДенег</p>   
    Процедура ОбработкаПроведения(Отказ, РежимПроведения)
      
      Движения.Взаиморасчеты.Записывать = Истина;
      Движения.Записать();
      
      Движения.Взаиморасчеты.Записывать = Истина;
      
      Блокировка = Новый БлокировкаДанных;
      ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.Взаиморасчеты");
      ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
      ЭлементБлокировки.УстановитьЗначение("Контрагент", Контрагент);
      Блокировка.Заблокировать();
    
      Запрос = Новый Запрос;
      Запрос.Текст = 
        "ВЫБРАТЬ
        |	ВзаиморасчетыОстатки.Контрагент КАК Контрагент,
        |	ВзаиморасчетыОстатки.Накладная КАК Накладная,
        |	ВзаиморасчетыОстатки.Валюта КАК Валюта,
        |	ВзаиморасчетыОстатки.СуммаОстаток КАК СуммаОстаток
        |ПОМЕСТИТЬ втДолгиПокупателей
        |ИЗ
        |	РегистрНакопления.Взаиморасчеты.Остатки(
        |			&МоментВремени,
        |			Контрагент = &Контрагент
        |				И Накладная <> ЗНАЧЕНИЕ(Документ.РасходнаяНакладная.ПустаяСсылка)) КАК ВзаиморасчетыОстатки
        |
        |ИНДЕКСИРОВАТЬ ПО
        |	Валюта
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |	втДолгиПокупателей.Контрагент КАК Контрагент,
        |	втДолгиПокупателей.Накладная КАК Накладная,
        |	втДолгиПокупателей.Валюта КАК Валюта,
        |	втДолгиПокупателей.СуммаОстаток КАК СуммаДолгаВВалюте,
        |	&Период КАК Период,
        |	ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 1) КАК Курс,
        |	втДолгиПокупателей.СуммаОстаток * ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 1) КАК СуммаДолгаВРублях
        |ИЗ
        |	втДолгиПокупателей КАК втДолгиПокупателей
        |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КурсыВалют.СрезПоследних(
        |				&Период,
        |				Валюта В
        |					(ВЫБРАТЬ
        |						втДолгиПокупателей.Валюта КАК Валюта
        |					ИЗ
        |						втДолгиПокупателей КАК втДолгиПокупателей)) КАК КурсыВалютСрезПоследних
        |		ПО втДолгиПокупателей.Валюта = КурсыВалютСрезПоследних.Валюта
        |
        |УПОРЯДОЧИТЬ ПО
        |	втДолгиПокупателей.Накладная.МоментВремени";
      
      Запрос.УстановитьПараметр("Контрагент", Контрагент);
      Запрос.УстановитьПараметр("МоментВремени", МоментВремени());
      Запрос.УстановитьПараметр("Период", Дата);
      
      РезультатЗапроса = Запрос.Выполнить();
      
      СуммаКОплатеВРублях = СуммаОплаты;
      
      Выборка = РезультатЗапроса.Выбрать();
      
      Пока Выборка.Следующий() И СуммаКОплатеВРублях > 0 Цикл
        
        СуммаВРублях = Мин(СуммаКОплатеВРублях, Выборка.СуммаДолгаВРублях);
        
        Если СуммаВРублях = Выборка.СуммаДолгаВРублях Тогда
          СуммаВВалюте = Выборка.СуммаДолгаВВалюте;
        Иначе
          СуммаВВалюте = Окр(СуммаВРублях / Выборка.Курс, 2);
        КонецЕсли;
        
        Если СуммаВВалюте > 0 Тогда
          Движение = Движения.Взаиморасчеты.ДобавитьРасход();
          ЗаполнитьЗначенияСвойств(Движение, Выборка);
          Движение.Сумма = СуммаВВалюте;
          
          СуммаКОплатеВРублях = СуммаКОплатеВРублях - СуммаВРублях;
        КонецЕсли;
        
      КонецЦикла;
      
      Если СуммаКОплатеВРублях > 0 Тогда
        
        Движение = Движения.Взаиморасчеты.ДобавитьРасход();
        Движение.Период = Дата;
        Движение.Контрагент = Контрагент;
        Движение.Накладная = Документы.РасходнаяНакладная.ПустаяСсылка();
        Движение.Валюта = Справочники.Валюты.РоссийскийРубль;
        Движение.Сумма = СуммаКОплатеВРублях;
        
      КонецЕсли;
      
    КонецПроцедуры
    
    <p>///// Документ ПриходнаяНакладная</p>
    Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
      СуммаПоДокументу = СписокНоменклатуры.Итог("Сумма");
    КонецПроцедуры
    
    <p>///// Документ РасходнаяНакладная</p> 
    Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
      СуммаПоДокументу = СписокНоменклатуры.Итог("Сумма");
    КонецПроцедуры
    
    Процедура ОбработкаПроведения(Отказ, РежимПроведения)
      
      Движения.Взаиморасчеты.Записывать = Истина;
      Движения.Записать();
      
      Движения.Взаиморасчеты.Записывать = Истина;
      
      Движение = Движения.Взаиморасчеты.ДобавитьПриход();
      Движение.Период = Дата;
      Движение.Контрагент = Контрагент;
      Движение.Накладная = Ссылка;
      Движение.Валюта = Валюта;
      Движение.Сумма = СуммаПоДокументу;
      
      Блокировка = Новый БлокировкаДанных;
      ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.Взаиморасчеты");
      ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
      ЭлементБлокировки.УстановитьЗначение("Контрагент", Контрагент);
      ЭлементБлокировки.УстановитьЗначение("Накладная", Документы.РасходнаяНакладная.ПустаяСсылка());
      Блокировка.Заблокировать();
      
      Запрос = Новый Запрос;
      Запрос.Текст = 
        "ВЫБРАТЬ
        |	-ВзаиморасчетыОстатки.СуммаОстаток КАК ОстатокАвансаВРублях,
        |	ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 1) КАК Курс,
        |	ВЫРАЗИТЬ(-ВзаиморасчетыОстатки.СуммаОстаток / ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 1) КАК ЧИСЛО(15, 2)) КАК ОстатокАвансаВВалюте
        |ИЗ
        |	РегистрНакопления.Взаиморасчеты.Остатки(
        |			&МоментВремени,
        |			Контрагент = &Контрагент
        |				И Накладная = ЗНАЧЕНИЕ(Документ.РасходнаяНакладная.ПустаяСсылка)) КАК ВзаиморасчетыОстатки
        |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КурсыВалют.СрезПоследних(&МоментВремени, Валюта = &Валюта) КАК КурсыВалютСрезПоследних
        |		ПО (ИСТИНА)";
      
      Запрос.УстановитьПараметр("Валюта", Валюта);
      Запрос.УстановитьПараметр("Контрагент", Контрагент);
      Запрос.УстановитьПараметр("МоментВремени", МоментВремени());
      
      РезультатЗапроса = Запрос.Выполнить();
      
      Выборка = РезультатЗапроса.Выбрать();
      Выборка.Следующий();
      
      Если Выборка.ОстатокАвансаВВалюте > 0 Тогда
        
        СуммаПоДокументуВВалюте = СуммаПоДокументу;
        СуммаПоДокументуВРублях = СуммаПоДокументуВВалюте * Выборка.Курс;
        
        Если Выборка.ОстатокАвансаВРублях >= СуммаПоДокументуВРублях Тогда
          СуммаСписанияАвансаВРублях = СуммаПоДокументуВРублях;
          СуммаЗачетаАвансаВВалюте   = СуммаПоДокументуВВалюте;
        Иначе
          СуммаСписанияАвансаВРублях = Выборка.ОстатокАвансаВРублях;
          СуммаЗачетаАвансаВВалюте   = Выборка.ОстатокАвансаВВалюте;
        КонецЕсли;
            
        Движение = Движения.Взаиморасчеты.ДобавитьПриход();
        Движение.Период = Дата;
        Движение.Контрагент = Контрагент;
        Движение.Накладная = Документы.РасходнаяНакладная.ПустаяСсылка();
        Движение.Валюта = Справочники.Валюты.РоссийскийРубль;
        Движение.Сумма = СуммаСписанияАвансаВРублях;
        
        Движение = Движения.Взаиморасчеты.ДобавитьРасход();
        Движение.Период = Дата;
        Движение.Контрагент = Контрагент;
        Движение.Накладная = Ссылка;
        Движение.Валюта = Валюта;
        Движение.Сумма = СуммаЗачетаАвансаВВалюте;
        
      КонецЕсли;
          
    КонецПроцедуры
    
    <p>///// Модуль формы</p>
    &НаКлиенте
    Процедура СписокНоменклатурыКоличествоПриИзменении(Элемент)
      ТекСтрока = Элементы.СписокНоменклатуры.ТекущиеДанные;
      ОбработкаТабличнойЧасти.РассчитатьСуммуВСтроке(ТекСтрока);
    КонецПроцедуры
    
    &НаКлиенте
    Процедура СписокНоменклатурыЦенаПриИзменении(Элемент)
      ТекСтрока = Элементы.СписокНоменклатуры.ТекущиеДанные;
      ОбработкаТабличнойЧасти.РассчитатьСуммуВСтроке(ТекСтрока);
    КонецПроцедуры
    <embed src="pdf/ОбщееОУ14.pdf" type="application/pdf" width="1200" height="800">
      <img src="pdf/ОУ14.jpg">
    <H2 class="OU">
      Бухгалтерский учет
    </H2>
    <p>///// Общий модуль ОбработкаТабличнойЧастиКлиент</p>
    Процедура РассчитатьСуммуВСтроке(ТекСтрока) Экспорт
      ТекСтрока.Сумма = ТекСтрока.Цена * ТекСтрока.Количество;
    КонецПроцедуры 
    
    <p>///// Документ Операция</p>   
    Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
      Если Не Движения.Управленческий.Записывать Тогда
        Движения.Управленческий.Прочитать();
        Движения.Управленческий.Записывать = Истина;
      КонецЕсли;
      
      Для Каждого Движение Из Движения.Управленческий Цикл
        Движение.Период = Дата;
        Движение.Активность = Не ПометкаУдаления;
      КонецЦикла;
    КонецПроцедуры
    
    Процедура ПриКопировании(ОбъектКопирования)	
      Выборка = РегистрыБухгалтерии.Управленческий.ВыбратьПоРегистратору(ОбъектКопирования.Ссылка);
      Пока Выборка.Следующий() Цикл
        Движение = Движения.Управленческий.Добавить();
        ЗаполнитьЗначенияСвойств(Движение, Выборка);
        ЗаполнитьЗначенияСвойств(Движение.СубконтоДт, Выборка.СубконтоДт);
        ЗаполнитьЗначенияСвойств(Движение.СубконтоКт, Выборка.СубконтоКт);
      КонецЦикла;
    КонецПроцедуры
     
    <p>///// Документ ПриходнаяНакладная</p>
    Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
      СуммаПоДокументу = СписокНоменклатуры.Итог("Сумма");
    КонецПроцедуры
    
    <p>///// Документ РасходнаяНакладная</p> 
    Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
      СуммаПоДокументу = СписокНоменклатуры.Итог("Сумма");
    КонецПроцедуры
    
    <p>///// Документ Сборка</p>  
    Процедура ОбработкаПроведения(Отказ, РежимПроведения)
      
      Движения.Управленческий.Записывать = Истина;
      Движения.Записать();
      
      Движения.Управленческий.Записывать = Истина;
        
      Блокировка = Новый БлокировкаДанных;
      ЭлементБлокировки = Блокировка.Добавить("РегистрБухгалтерии.Управленческий");
      ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
      ЭлементБлокировки.УстановитьЗначение("Счет", ПланыСчетов.Управленческий.Материалы);
      ЭлементБлокировки.УстановитьЗначение(ПланыВидовХарактеристик.ВидыСубконто.Склады, СкладОтправитель);
      ЭлементБлокировки.ИсточникДанных = СписокНоменклатуры;
      ЭлементБлокировки.ИспользоватьИзИсточникаДанных(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура, "Номенклатура");
      Блокировка.Заблокировать();
      
      Запрос = Новый Запрос;
      МенеджерВТ = Новый МенеджерВременныхТаблиц;
      Запрос.МенеджерВременныхТаблиц = МенеджерВТ;
      Запрос.Текст = 
        "ВЫБРАТЬ
        |	СборкаСписокНоменклатуры.Номенклатура КАК Номенклатура,
        |	СУММА(СборкаСписокНоменклатуры.Количество) КАК Количество,
        |	МАКСИМУМ(СборкаСписокНоменклатуры.Ссылка.Количество) КАК КоличествоКомплекта
        |ПОМЕСТИТЬ втТЧТовары
        |ИЗ
        |	Документ.Сборка.СписокНоменклатуры КАК СборкаСписокНоменклатуры
        |ГДЕ
        |	СборкаСписокНоменклатуры.Ссылка = &Ссылка
        |
        |СГРУППИРОВАТЬ ПО
        |	СборкаСписокНоменклатуры.Номенклатура
        |
        |ИНДЕКСИРОВАТЬ ПО
        |	Номенклатура
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |	втТЧТовары.Номенклатура КАК Номенклатура,
        |	втТЧТовары.Номенклатура.Представление КАК НоменклатураПредставление,
        |	втТЧТовары.Количество КАК Количество,
        |	ЕСТЬNULL(УправленческийОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,
        |	ЕСТЬNULL(УправленческийОстатки.СуммаОстаток, 0) КАК СуммаОстаток
        |ИЗ
        |	втТЧТовары КАК втТЧТовары
        |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Управленческий.Остатки(
        |				&МоментВремени,
        |				Счет = &СчетМатериалы,
        |				&ВидыСубконто,
        |				Субконто1 В
        |						(ВЫБРАТЬ
        |							втТЧТовары.Номенклатура КАК Номенклатура
        |						ИЗ
        |							втТЧТовары КАК втТЧТовары)
        |					И Субконто2 = &Склад) КАК УправленческийОстатки
        |		ПО втТЧТовары.Номенклатура = УправленческийОстатки.Субконто1";
      ВидыСубконто = Новый Массив;
      ВидыСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконто.Номенклатура);
      ВидыСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконто.Склады);	
      Запрос.УстановитьПараметр("ВидыСубконто", ВидыСубконто);
      Запрос.УстановитьПараметр("МоментВремени", МоментВремени());
      Запрос.УстановитьПараметр("Склад", СкладОтправитель);
      Запрос.УстановитьПараметр("Ссылка", Ссылка);
      Запрос.УстановитьПараметр("СчетМатериалы", ПланыСчетов.Управленческий.Материалы);
      
      РезультатЗапроса = Запрос.Выполнить();
      
      Выборка = РезультатЗапроса.Выбрать();
      
      СебестоимостьИтого = 0;
      
      Пока Выборка.Следующий() Цикл
        
        Если Выборка.Количество > Выборка.КоличествоОстаток Тогда
          Отказ = Истина;
          Сообщение = Новый СообщениеПользователю;
          Сообщение.Текст = СтрШаблон("Недостаточно товара %1 в количестве %2",
          Выборка.НоменклатураПредставление, Выборка.Количество - Выборка.КоличествоОстаток);
          Сообщение.Сообщить();
        КонецЕсли;
        
        Если Отказ Тогда
          Продолжить;
        КонецЕсли;
        
        Если Выборка.Количество = Выборка.КоличествоОстаток Тогда
          Себестоимость = Выборка.СуммаОстаток;
        Иначе
          Себестоимость = Выборка.СуммаОстаток / Выборка.КоличествоОстаток * Выборка.Количество;
        КонецЕсли;
        
        Движение = Движения.Управленческий.Добавить();
        Движение.Период = Дата;
        Движение.СчетДт = ПланыСчетов.Управленческий.ОсновноеПроизводство;
        Движение.СчетКт = ПланыСчетов.Управленческий.Материалы;
        Движение.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Выборка.Номенклатура;
        Движение.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = СкладОтправитель;
        Движение.КоличествоКт = Выборка.Количество;
        Движение.Сумма = Себестоимость;
        
        СебестоимостьИтого = СебестоимостьИтого + Движение.Сумма;
            
      КонецЦикла;
      
      Если Отказ Тогда
        Возврат;
      КонецЕсли;
      
      Запрос = Новый Запрос;
      Запрос.МенеджерВременныхТаблиц = МенеджерВТ;
      Запрос.Текст = 
        "ВЫБРАТЬ
        |	СоставКомплектов.Комплектующая КАК Комплектующая,
        |	СоставКомплектов.Количество КАК Количество
        |ПОМЕСТИТЬ втСоставКомплектов
        |ИЗ
        |	РегистрСведений.СоставКомплектов КАК СоставКомплектов
        |ГДЕ
        |	СоставКомплектов.Комплект = &Комплект
        |
        |ИНДЕКСИРОВАТЬ ПО
        |	Комплектующая
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ ПЕРВЫЕ 1
        |	1 КАК Результат
        |ИЗ
        |	втТЧТовары КАК втТЧТовары
        |		ПОЛНОЕ СОЕДИНЕНИЕ втСоставКомплектов КАК втСоставКомплектов
        |		ПО втТЧТовары.Номенклатура = втСоставКомплектов.Комплектующая
        |ГДЕ
        |	ЕСТЬNULL(втТЧТовары.Количество / втТЧТовары.КоличествоКомплекта, 0) <> ЕСТЬNULL(втСоставКомплектов.Количество, 0)";
      
      Запрос.УстановитьПараметр("Комплект", Номенклатура);
      
      РезультатЗапроса = Запрос.Выполнить();
      
      ТипСборки = ?(РезультатЗапроса.Пустой(), Перечисления.ТипыСборки.Стандарт, Перечисления.ТипыСборки.Нестандарт);
      
      Движение = Движения.Управленческий.Добавить();
      Движение.Период = Дата;
      Движение.СчетДт = ПланыСчетов.Управленческий.Товары;
      Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Номенклатура] = Номенклатура;
      Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Склады] = СкладПолучатель;
      Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.ТипыСборки] = ТипСборки;
      Движение.КоличествоДт = Количество;
      Движение.СчетКт = ПланыСчетов.Управленческий.ОсновноеПроизводство;
      Движение.Сумма = СебестоимостьИтого;
      
    КонецПроцедуры
    
    <p>///// Модуль формы</p>
    &НаКлиенте
    Процедура СписокНоменклатурыКоличествоПриИзменении(Элемент)
      ТекСтрока = Элементы.СписокНоменклатуры.ТекущиеДанные;
      ОбработкаТабличнойЧасти.РассчитатьСуммуВСтроке(ТекСтрока);
    КонецПроцедуры
    
    &НаКлиенте
    Процедура СписокНоменклатурыЦенаПриИзменении(Элемент)
      ТекСтрока = Элементы.СписокНоменклатуры.ТекущиеДанные;
      ОбработкаТабличнойЧасти.РассчитатьСуммуВСтроке(ТекСтрока);
    КонецПроцедуры
    <embed src="pdf/ОбщееБУ14.pdf" type="application/pdf" width="1200" height="800">
      <img src="pdf/БУ14.jpg">
    <H2 class="OU">
      Расчеты
    </H2>
    <p>///// Документ НачислениеЗарплаты</p>   
    Процедура ОбработкаПроведения(Отказ, РежимПроведения)
      
      ПериодРегистрации = НачалоМесяца(Дата);
      КонецПериодаРегистрации = КонецМесяца(ПериодРегистрации);
        
      Движения.ОсновныеНачисления.Записывать = Истина;
      Для Каждого Строка Из ОсновныеНачисления Цикл
        Движение = Движения.ОсновныеНачисления.Добавить();
        ЗаполнитьЗначенияСвойств(Движение, Строка);
        Движение.ПериодРегистрации = ПериодРегистрации;
        Движение.ПериодДействияНачало = Строка.ДатаНачала;
        Движение.ПериодДействияКонец = КонецДня(Строка.ДатаОкончания);
      КонецЦикла;
      
      Движения.ДополнительныеНачисления.Записывать = Истина;
      Для Каждого Строка Из ДополнительныеНачисления Цикл
        Движение = Движения.ДополнительныеНачисления.Добавить();
        ЗаполнитьЗначенияСвойств(Движение, Строка);
        Движение.ПериодРегистрации = ПериодРегистрации;
        Если Строка.ВидРасчета = ПланыВидовРасчета.ДополнительныеНачисления.Премия Тогда
          Движение.БазовыйПериодНачало = ПериодРегистрации;
          Движение.БазовыйПериодКонец = КонецПериодаРегистрации;
        КонецЕсли;
      КонецЦикла;	
      Движения.Записать();
      
      Запрос = Новый Запрос;
      Запрос.Текст = 
        "ВЫБРАТЬ
        |	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
        |	ОсновныеНачисления.Сотрудник КАК Сотрудник,
        |	ОсновныеНачисления.Подразделение КАК Подразделение,
        |	ОсновныеНачисления.ПериодДействияНачало КАК ПериодДействияНачало,
        |	ОсновныеНачисления.ПериодДействияКонец КАК ПериодДействияКонец,
        |	ОсновныеНачисления.ВидРасчета КАК ВидРасчета
        |ПОМЕСТИТЬ втДанныеНачислений
        |ИЗ
        |	РегистрРасчета.ОсновныеНачисления КАК ОсновныеНачисления
        |ГДЕ
        |	ОсновныеНачисления.Регистратор = &Регистратор
        |	И ОсновныеНачисления.ВидРасчета В(&ВидыРасчета)
        |	И ОсновныеНачисления.Активность
        |
        |ИНДЕКСИРОВАТЬ ПО
        |	Сотрудник,
        |	Подразделение
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |	втДанныеНачислений.НомерСтроки КАК НомерСтроки,
        |	СУММА(ЕСТЬNULL(ДанныеТабеляОбороты.ЧасовОборот, 0)) КАК Часов
        |ПОМЕСТИТЬ втДанныеЯвки
        |ИЗ
        |	втДанныеНачислений КАК втДанныеНачислений
        |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ДанныеТабеля.Обороты(
        |				&ПериодРегистрации,
        |				&КонецПериодаРегистрации,
        |				День,
        |				(Сотрудник, Подразделение) В
        |						(ВЫБРАТЬ
        |							втДанныеНачислений.Сотрудник КАК Сотрудник,
        |							втДанныеНачислений.Подразделение КАК Подразделение
        |						ИЗ
        |							втДанныеНачислений КАК втДанныеНачислений
        |						ГДЕ
        |							втДанныеНачислений.ВидРасчета В (&ВидыРасчетаЯвки))
        |					И ВидВремени = ЗНАЧЕНИЕ(Справочник.ВидыВремени.Явка)) КАК ДанныеТабеляОбороты
        |		ПО втДанныеНачислений.Сотрудник = ДанныеТабеляОбороты.Сотрудник
        |			И втДанныеНачислений.Подразделение = ДанныеТабеляОбороты.Подразделение
        |			И втДанныеНачислений.ПериодДействияНачало <= ДанныеТабеляОбороты.Период
        |			И втДанныеНачислений.ПериодДействияКонец >= ДанныеТабеляОбороты.Период
        |ГДЕ
        |	втДанныеНачислений.ВидРасчета В(&ВидыРасчетаЯвки)
        |
        |СГРУППИРОВАТЬ ПО
        |	втДанныеНачислений.НомерСтроки
        |
        |ИНДЕКСИРОВАТЬ ПО
        |	НомерСтроки
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |	втДанныеНачислений.НомерСтроки КАК НомерСтроки,
        |	СУММА(ЕСТЬNULL(ДанныеТабеляОбороты.ДнейОборот, 0)) КАК Дней
        |ПОМЕСТИТЬ втДанныеНевыходов
        |ИЗ
        |	втДанныеНачислений КАК втДанныеНачислений
        |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ДанныеТабеля.Обороты(
        |				&ПериодРегистрации,
        |				&КонецПериодаРегистрации,
        |				День,
        |				(Сотрудник, Подразделение) В
        |						(ВЫБРАТЬ
        |							втДанныеНачислений.Сотрудник КАК Сотрудник,
        |							втДанныеНачислений.Подразделение КАК Подразделение
        |						ИЗ
        |							втДанныеНачислений КАК втДанныеНачислений
        |						ГДЕ
        |							втДанныеНачислений.ВидРасчета В (&ВидыРасчетаНевыходы))
        |					И ВидВремени = ЗНАЧЕНИЕ(Справочник.ВидыВремени.Невыход)) КАК ДанныеТабеляОбороты
        |		ПО втДанныеНачислений.Сотрудник = ДанныеТабеляОбороты.Сотрудник
        |			И втДанныеНачислений.Подразделение = ДанныеТабеляОбороты.Подразделение
        |			И втДанныеНачислений.ПериодДействияНачало <= ДанныеТабеляОбороты.Период
        |			И втДанныеНачислений.ПериодДействияКонец >= ДанныеТабеляОбороты.Период
        |ГДЕ
        |	втДанныеНачислений.ВидРасчета В(&ВидыРасчетаНевыходы)
        |
        |СГРУППИРОВАТЬ ПО
        |	втДанныеНачислений.НомерСтроки
        |
        |ИНДЕКСИРОВАТЬ ПО
        |	НомерСтроки
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |	втДанныеНачислений.НомерСтроки КАК НомерСтроки,
        |	ЕСТЬNULL(втДанныеЯвки.Часов, 0) КАК ОтработаноЧасов,
        |	ЕСТЬNULL(СведенияОСотрудникахСрезПоследних.ТарифнаяСтавка, 0) КАК ТарифнаяСтавка,
        |	ЕСТЬNULL(втДанныеНевыходов.Дней, 0) КАК ДнейНевыхода
        |ИЗ
        |	втДанныеНачислений КАК втДанныеНачислений
        |		ЛЕВОЕ СОЕДИНЕНИЕ втДанныеЯвки КАК втДанныеЯвки
        |		ПО втДанныеНачислений.НомерСтроки = втДанныеЯвки.НомерСтроки
        |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОСотрудниках.СрезПоследних(
        |				&ПериодРегистрации,
        |				(Сотрудник, Подразделение) В
        |					(ВЫБРАТЬ
        |						втДанныеНачислений.Сотрудник КАК Сотрудник,
        |						втДанныеНачислений.Подразделение КАК Подразделение
        |					ИЗ
        |						втДанныеНачислений КАК втДанныеНачислений)) КАК СведенияОСотрудникахСрезПоследних
        |		ПО втДанныеНачислений.Сотрудник = СведенияОСотрудникахСрезПоследних.Сотрудник
        |			И втДанныеНачислений.Подразделение = СведенияОСотрудникахСрезПоследних.Подразделение
        |		ЛЕВОЕ СОЕДИНЕНИЕ втДанныеНевыходов КАК втДанныеНевыходов
        |		ПО втДанныеНачислений.НомерСтроки = втДанныеНевыходов.НомерСтроки";
    
      ВидыРасчета = Новый Массив;
      ВидыРасчета.Добавить(ПланыВидовРасчета.ОсновныеНачисления.ОплатаПоЧасовомуТарифу);
      ВидыРасчета.Добавить(ПланыВидовРасчета.ОсновныеНачисления.Невыход);
      Запрос.УстановитьПараметр("ВидыРасчета", ВидыРасчета);
      
      ВидыРасчетаЯвки = Новый Массив;
      ВидыРасчетаЯвки.Добавить(ПланыВидовРасчета.ОсновныеНачисления.ОплатаПоЧасовомуТарифу);
      Запрос.УстановитьПараметр("ВидыРасчетаЯвки", ВидыРасчетаЯвки);
      
      ВидыРасчетаНевыходы = Новый Массив;
      ВидыРасчетаНевыходы.Добавить(ПланыВидовРасчета.ОсновныеНачисления.Невыход);	
      Запрос.УстановитьПараметр("ВидыРасчетаНевыходы", ВидыРасчетаНевыходы);
      
      Запрос.УстановитьПараметр("ПериодРегистрации", ПериодРегистрации);
      Запрос.УстановитьПараметр("КонецПериодаРегистрации", КонецПериодаРегистрации);
      
      Запрос.УстановитьПараметр("Регистратор", Ссылка);
      
      РезультатЗапроса = Запрос.Выполнить();
      
      Выборка = РезультатЗапроса.Выбрать();
      
      Для Каждого Движение Из Движения.ОсновныеНачисления Цикл
        
        Если ВидыРасчета.Найти(Движение.ВидРасчета) = Неопределено Тогда
          Продолжить;
        КонецЕсли;
        
        Выборка.Сбросить();
        Выборка.НайтиСледующий(Движение.НомерСтроки, "НомерСтроки");
        
        Если Движение.ВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.ОплатаПоЧасовомуТарифу Тогда
          Движение.Результат = Выборка.ОтработаноЧасов * Выборка.ТарифнаяСтавка;
          ЗаполнитьЗначенияСвойств(Движение, Выборка, "ОтработаноЧасов, ТарифнаяСтавка");
        ИначеЕсли Движение.ВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.Невыход Тогда
          Движение.Результат = 0;
          ЗаполнитьЗначенияСвойств(Движение, Выборка, "ДнейНевыхода");
        КонецЕсли;
        
      КонецЦикла;
      
      Движения.ОсновныеНачисления.Записать(, Истина);
      
      Запрос = Новый Запрос;
      Запрос.Текст = 
        "ВЫБРАТЬ
        |	ДополнительныеНачисленияБазаОсновныеНачисления.НомерСтроки КАК НомерСтроки,
        |	ДополнительныеНачисленияБазаОсновныеНачисления.РезультатБаза КАК БазаНачислений
        |ИЗ
        |	РегистрРасчета.ДополнительныеНачисления.БазаОсновныеНачисления(
        |			&Измерения,
        |			&Измерения,
        |			,
        |			Регистратор = &Регистратор
        |				И ВидРасчета В (&ВидыРасчета)) КАК ДополнительныеНачисленияБазаОсновныеНачисления";
      
      ВидыРасчета = Новый Массив;
      ВидыРасчета.Добавить(ПланыВидовРасчета.ДополнительныеНачисления.Премия);
      Запрос.УстановитьПараметр("ВидыРасчета", ВидыРасчета);
      
      Измерения = Новый Массив;
      Измерения.Добавить("Сотрудник");
      Измерения.Добавить("Подразделение");
      Запрос.УстановитьПараметр("Измерения", Измерения);
      
      Запрос.УстановитьПараметр("Регистратор", Ссылка);
      
      РезультатЗапроса = Запрос.Выполнить();
      
      Выборка = РезультатЗапроса.Выбрать();
      
      Для Каждого Движение Из Движения.ДополнительныеНачисления Цикл
        Если ВидыРасчета.Найти(Движение.ВидРасчета) = Неопределено Тогда
          Продолжить;
        КонецЕсли;
        
        Выборка.Сбросить();
        Если Выборка.НайтиСледующий(Движение.НомерСтроки, "НомерСтроки") Тогда
          Если Движение.ВидРасчета = ПланыВидовРасчета.ДополнительныеНачисления.Премия Тогда
            Движение.Результат = Выборка.БазаНачислений * Движение.Параметр / 100;
            ЗаполнитьЗначенияСвойств(Движение, Выборка, "БазаНачислений");
          КонецЕсли;
        КонецЕсли;
      КонецЦикла;
      
      Движения.ДополнительныеНачисления.Записать();
      
    КонецПроцедуры
    
    Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)
      Если ОсновныеНачисления.Количество() = 0 И ДополнительныеНачисления.Количество() = 0 Тогда
        Сообщение = Новый СообщениеПользователю;
        Сообщение.Текст = "Документ не заполнен!";
        Сообщение.Сообщить();		            
        Отказ = Истина;
        Возврат;
      КонецЕсли;
    КонецПроцедуры
    
    <p>///// Документ Табель</p>
    Процедура ОбработкаПроведения(Отказ, РежимПроведения)
    
      ПериодРегистрации = НачалоМесяца(Дата);
      
      Движения.ДанныеТабеля.Записывать = Истина;
      
      Для Каждого Строка Из ДанныеТабеля Цикл
        
        ПоследнийДеньМесяца = День(КонецМесяца(Дата));
        
        Для НомерДня = 1 По ПоследнийДеньМесяца Цикл
          
          ЗначениеЯчейки = ВРег(СокрЛП(Строка["День" + НомерДня]));
          
          Если ЗначениеЯчейки <> "" Тогда
            
            Период = ПериодРегистрации + (НомерДня - 1)*24*3600;
            
            Попытка
              Если ЗначениеЯчейки = "Н" Тогда
                ВидВремени = Справочники.ВидыВремени.Невыход;	
                Часов = 0;	
              Иначе	
                ВидВремени = Справочники.ВидыВремени.Явка;
                Часов = Число(ЗначениеЯчейки);
              КонецЕсли;
            Исключение
              Сообщение = Новый СообщениеПользователю;
              Сообщение.Текст = СтрШаблон("Некорректный ввод данных (строка %1, день %2)", Строка.НомерСтроки, НомерДня);
              Сообщение.Сообщить();
              Продолжить;
              Отказ = Истина;
            КонецПопытки;
            
            Движение = Движения.ДанныеТабеля.Добавить();
            Движение.Период = Период;
            Движение.Сотрудник = Строка.Сотрудник;
            Движение.Подразделение = Подразделение;
            Движение.ВидВремени = ВидВремени;
            Движение.Часов = Часов;
            Движение.Дней = 1;
        
          КонецЕсли;
          
        КонецЦикла;
        
      КонецЦикла;
      
    КонецПроцедуры
    
    <p>///// Модуль объекта ЗаполнениеГрафика</p>
    Процедура ЗаполнитьГрафик(ДатаНачала, ДатаОкончания, ВыходныеДни, ГрафикРаботы) Экспорт 
      
      Набор = РегистрыСведений.ГрафикиРаботы.СоздатьНаборЗаписей();
      
      Набор.Отбор.ГрафикРаботы.Установить(ГрафикРаботы);
        
      ЧислоСекундВСутках = 86400;
      
      Дат = ДатаНачала;	
      Пока Дат <= ДатаОкончания Цикл
        Запись = Набор.Добавить();
        Запись.ГрафикРаботы = ГрафикРаботы;
        Запись.Дата = Дат;
        Если Найти(ВыходныеДни, Строка(ДеньНедели(Дат))) Тогда
          Запись.Значение = 0;
        Иначе	          
          Запись.Значение = 8;
        КонецЕсли; 
        Дат = Дат + ЧислоСекундВСутках;
      КонецЦикла; 
      Набор.Записать();
    КонецПроцедуры
    
    <p>///// Модуль формы</p>
    &НаКлиенте
    Процедура Заполнить(Команда)
      ВыполнитьОбработку();
      Сообщить("Обработка завершена!");
    КонецПроцедуры
    
    &НаСервере
    Процедура ВыполнитьОбработку()
      ОбработкаОбъект = РеквизитФормыВЗначение("Объект");
        ОбработкаОбъект.ЗаполнитьГрафик(ВыборПериода.ДатаНачала, ВыборПериода.ДатаОкончания, ВыходныеДни, ГрафикРаботы);
    КонецПроцедуры
    <embed src="pdf/ОбщееСПР14.pdf" type="application/pdf" width="1200" height="800">
      <img src="pdf/СПР14.jpg">
  </pre>
</body>

</html>